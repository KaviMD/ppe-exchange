{% extends "base.html" %}

{% block app_content %}
<div class="content">
    <h1>User and Hospital List</h1>
    <table class="table table-hover">
        <thead>
            <tr>
            <th scope="col">ID</th>
            <th scope="col">Username</th>
            <th scope="col">Email</th>
            <th scope="col">Hospital</th>
            <th scope="col">Contact</th>
            <th scope="col">Address</th>
            <th scope="col">Account Type</th>
            <th scope="col">Verified</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <th scope="row">{{ user.id }}</th>
                <td>{{ user.username }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.hospital }}</td>
                <td>{{ user.contact }}</td>
                <td>{{ user.address }}</td>
                <td>{% if user.is_admin %}
                        Admin
                    {% else %}
                        User
                    {% endif %}
                </td>
                <td>{% if user.is_verified %}
                        <b>Yes: &nbsp;&nbsp;&nbsp;</b> <button id="button-{{ user.id }}" type="button" class="btn btn-danger btn-sm" {% if not user.is_admin%} onclick="editUser('{{ user.id }}', 'remove')" {% else %} disabled {% endif %}>Remove</button>
                    {% elif user.verification_pending %}
                       <b>Pending: &nbsp;&nbsp;&nbsp;</b> <button id="button-{{ user.id }}" onclick="editUser('{{ user.id }}', 'cancel')" type="button" class="btn btn-danger btn-sm">Cancel</button>
                    {% else %}
                       <b>No: &nbsp;&nbsp;&nbsp;</b> <button id="button-{{ user.id }}" onclick="editUser('{{ user.id }}', 'verify')" type="button" class="btn btn-success btn-sm">Verify</button>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <script>
        function editUser(user_id, task) {
            data = {user_id: user_id, task: task};

            var button = $("#button-"+String(user_id));
            button.attr("onclick", "");
            button.prop("disabled", true);

            $.ajax({
                url: "/update_admin_users",
                type: "POST",
                contentType:'application/json',
                data: JSON.stringify(data),
                dataType:'json',
		        success: function(result) {
                    location.reload();
                },
                error: function(result) {
                    alert("There was an error please reload and try again");
                }
            });
        }
    </script>
</div>
{% endblock %}
