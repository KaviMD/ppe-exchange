{% extends "base.html" %}

{% block app_content %}
<div class="modal fade" tabindex="-1" role="dialog" id="add-ppe-modal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Add a PPE Type</h4>
            </div>
            <div class="modal-body">
                <input type="search" style="width: 100%" class="form-control" placeholder="Search for a PPE Type" id="add-ppe-type-search"/>
                <br/>
                <table class="table table-striped" id="add-ppe-types">
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th>SKU</th>
                            <th>Description</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for ppe in ppe_types %}
                        <tr data-searchable="{{ ppe.sku.upper() }} {{ ppe.desc.upper() }}">
                            <td><img class="itmimg" src="{{ ppe.img.decode() }}" alt="{{ ppe.desc }} mask image" width="150" /></td>
                            <td>{{ ppe.sku }}</td>
                            <td>{{ ppe.desc }}</td>
                            <td>
                                <!-- TODO: Don't allow duplication and/or has+wanting the same thing! -->
                                <button class="btn btn-primary add-ppe-type" data-id="{{ ppe.id }}" data-dismiss="modal"><i class="glyphicon glyphicon-plus"></i> Add</button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div class="content">
    <h1>Hi, {{ current_user.username }} from {{ hospital.hospital_name }} !</h1>
    <div class="well current-exchanges">
        <h2>Your Exchanges</h2>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>With</th>
                    <th>Status</th>
                    <th>Receiving</th>
                    <th>Giving</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>12</td>
                    <td><a href="#">Virginia Mason</a></td>
                    <td><span class="badge badge-secondary">Pending</span></td>
                    <td>2000 N95, 300 P50</td>
                    <td>5000 Surgical Masks</td>
                    <td><a href="#">Details</a></td>
                </tr>
            </tbody>
        </table>
    </div>
    <div id="wants" class="ppe-container">
        <form action="/update-ppe/wants" method="POST">
    <h2>
        PPE Types You Want
        <button data-target="#wants" class="btn btn-primary no-edit start-edit"><span class="glyphicon glyphicon-pencil" aria-hidden="true" ></span> Edit</button>
        <input type="submit" class="btn btn-primary only-edit" value="Done"/>
    </h2>
    <p class="help-text only-edit">Set a PPE's quantity to 0 to delete.</p>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Image</th>
                <th>SKU</th>
                <th>Description</th>
                <th>Quantity Wanted</th>
            </tr>
        </thead>
        <tbody>
            <tr class="only-edit">
                <td colspan="4">
                    <div style="display: flex; width: 100%; align-items: center; justify-content: center; flex-direction: row;">
                        <button class="btn btn-primary" data-toggle="modal" data-target="#add-ppe-modal" onclick="return false;">
                            <i class="glyphicon glyphicon-plus" aria-hidden="true"></i> Add PPE Type
                        </button>
                    </div>
                </td>
            </tr>
            {% for want in wants %}
            <tr>
                <td><img class="itmimg" src="{{ want.ppe.img.decode() }}" alt="{{ want.ppe.desc }} mask image" width="150" /></td>
                <td>{{ want.ppe.sku }}</td>
                <td>{{ want.ppe.desc }}</td>
                <td>
                    <span class="no-edit">{{ want.count }}</span>
                    <input class="form-control" name="ppe-{{want.ppe.id}}" type="number" min="0" max="999999999" step="1" value="{{want.count}}" />
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</form>
    </div>
</div>
<style>
    .ppe-container:not(.edit) input:not(.no-edit),
    .ppe-container:not(.edit) .only-edit,
    .ppe-container.edit .no-edit {
        display: none;
    }
</style>
<script>
    $('.start-edit').click(function (e) {
        e.preventDefault();
        $($(this).data('target')).addClass('edit');
    });

    $('#add-ppe-type-search').keyup(function () {
        var query = $(this).val().toUpperCase()
        $('#add-ppe-types > tbody > tr').each(function () {
            var self = $(this)   
            // data-searchable is uppercased in the template for efficiency
            if (self.data('searchable').indexOf(query) === -1) self.hide()
            else self.show()
        })
    })
</script>
{% endblock %}